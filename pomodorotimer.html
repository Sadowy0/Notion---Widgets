<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pomodoro Timer</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { height: 100%; width: 100%; overflow: hidden; background: #191919; color: white; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; display: flex; justify-content: center; align-items: center; text-align: center; }
        #main-scaler { display: flex; flex-direction: column; align-items: center; width: 300px; transition: transform 0.1s ease-out; padding: 5px; }
        .container, .display { display: flex; flex-direction: column; align-items: center; width: 100%; }
        .display { gap: 0; }
        .time-stats { font-size: 16px; font-weight: 700; opacity: 0.5; line-height: 1; order: 1; margin-bottom: -5px; position: relative; z-index: 2; letter-spacing: 0.5px; width: 100%; pointer-events: none; }
        .timer-wrapper { position: relative; display: flex; align-items: center; justify-content: center; width: 100%; order: 2; z-index: 1; }
        .timer-display { font-size: 110px; font-weight: 900; line-height: 0.85; letter-spacing: -5px; font-variant-numeric: tabular-nums; display: flex; align-items: center; }
        .t-btn { cursor: pointer; transition: opacity 0.2s; -webkit-tap-highlight-color: transparent; }
        .t-btn:hover { opacity: 0.6; }
        .colon-box { display: flex; flex-direction: column; justify-content: center; gap: 12px; height: 100%; padding: 0 4px; margin-top: 5px; }
        .dot { width: 12px; height: 12px; background: white; border-radius: 50%; pointer-events: none; }
        .status-text { font-size: 18px; font-weight: 900; opacity: 0.9; letter-spacing: 1.5px; order: 3; margin-top: 2px; line-height: 1; position: relative; z-index: 2; pointer-events: none; text-transform: uppercase; }
        .settings { display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); flex-direction: column; gap: 10px; padding: 15px; background: #1f1f1f; border-radius: 12px; border: 1px solid rgba(255, 255, 255, 0.1); z-index: 2000; width: 220px; }
        .settings.active { display: flex; }
        .settings-row { display: flex; gap: 8px; justify-content: center; }
        .setting-item { display: flex; flex-direction: column; gap: 4px; align-items: center; flex: 1; }
        .setting-label { font-size: 9px; font-weight: 800; opacity: 0.5; text-transform: uppercase; }
        input { background: #2a2a2a; border: 1px solid #3d3d3d; color: white; padding: 4px; border-radius: 4px; width: 100%; text-align: center; font-size: 11px; font-weight: 700; }
        .toggle-btn { width: 36px; height: 20px; background: #444; border-radius: 10px; position: relative; cursor: pointer; border: none; }
        .toggle-btn.active { background: #007AFF; }
        .toggle-btn::before { content: ''; position: absolute; width: 14px; height: 14px; background: white; border-radius: 50%; top: 3px; left: 3px; transition: 0.2s; }
        .toggle-btn.active::before { left: 19px; }
        .settings-actions { display: flex; gap: 6px; margin-top: 5px; }
        .btn { border: none; border-radius: 6px; cursor: pointer; background: rgba(255, 255, 255, 0.1); color: white; transition: all 0.2s ease; display: flex; align-items: center; justify-content: center; -webkit-tap-highlight-color: transparent; }
        .action-btn { flex: 1; height: 32px; font-size: 10px; font-weight: 800; }
        .btn-save { background: #007AFF; }
        .btn-reset { background: rgba(255, 69, 58, 0.2); color: #ff453a; }
        .overlay { display: none; position: fixed; top:0; left:0; right:0; bottom:0; z-index:1500; background: rgba(0,0,0,0.7); }
        .overlay.active { display: block; }
    </style>
</head>
<body>
    <div class="overlay" id="overlay"></div>
    <div id="main-scaler">
        <div class="container">
            <div class="display">
                <div class="time-stats"><span id="workMinutesTotal">0</span>m <span id="sessionName">nauki</span> | <span id="breakMinutesTotal">0</span>m pauzy</div>
                <div class="timer-wrapper">
                    <div class="timer-display">
                        <span id="m1" class="t-btn">2</span><span id="m2">5</span>
                        <div id="colon" class="colon-box t-btn"><div class="dot"></div><div class="dot"></div></div>
                        <span id="s1">0</span><span id="s2" class="t-btn">0</span>
                    </div>
                </div>
                <div class="status-text" id="statusText">NAUKA</div>
            </div>
        </div>
    </div>
    <div class="settings" id="settings">
        <div class="settings-row">
            <div class="setting-item"><label class="setting-label">Praca</label><input type="number" id="workIn" value="25"></div>
            <div class="setting-item"><label class="setting-label">Pauza</label><input type="number" id="breakIn" value="5"></div>
            <div class="setting-item"><label class="setting-label">Długa</label><input type="number" id="longIn" value="15"></div>
            <div class="setting-item"><label class="setting-label">LB</label><button class="toggle-btn active" id="lbToggle"></button></div>
        </div>
        <div class="settings-actions">
            <button class="btn action-btn btn-save" id="save">ZAPISZ</button>
            <button class="btn action-btn btn-reset" id="reset">RESET</button>
        </div>
    </div>
    <script>
        const e=id=>document.getElementById(id), snd=new Audio('https://cdn.pixabay.com/audio/2022/03/15/audio_7833324f4b.mp3');
        let c=JSON.parse(localStorage.getItem('pomoConfig'))||{work:25,break:5,long:15,name:'nauka',lbEnabled:true},
            s=JSON.parse(localStorage.getItem('pomoStats'))||{workSecs:0,breakSecs:0},
            t=c.work*60, r=false, w=true, sl=4, iv=null, et=null;

        const update=()=>{
            const m=Math.floor(t/60), sec=t%60, ms=String(m).padStart(2,'0'), ss=String(sec).padStart(2,'0');
            e('m1').textContent=ms[0]; e('m2').textContent=ms[1];
            e('s1').textContent=ss[0]; e('s2').textContent=ss[1];
            e('workMinutesTotal').textContent=Math.floor(s.workSecs/60); e('breakMinutesTotal').textContent=Math.floor(s.breakSecs/60);
            e('statusText').textContent=w?c.name.toUpperCase():(sl===0&&c.lbEnabled?"DŁUGA PRZERWA":"PRZERWA");
            document.title=`${ms}:${ss} - ${w?c.name:'Przerwa'}`; fit();
        };

        const fit=()=>{ 
            const sc = Math.min(window.innerWidth / 300, window.innerHeight / 150, 1); 
            e('main-scaler').style.transform = `scale(${sc})`; 
        };
        
        const phase=()=>{ 
            if(w){ sl--; t=(c.lbEnabled&&sl<=0)?c.long*60:c.break*60; if(sl<=0)sl=4; } 
            else { if(sl<=0)sl=4; t=c.work*60; } 
            w=!w; snd.play(); 
        };

        const tick=()=>{
            if(!r)return; const now=Date.now(), old=t; t=Math.max(0,Math.round((et-now)/1000));
            let d=old-t; if(d>0){ w?s.workSecs+=d:s.breakSecs+=d; localStorage.setItem('pomoStats',JSON.stringify(s)); }
            if(t<=0){ phase(); et=Date.now()+(t*1000); } update();
        };

        const start=()=>{ r=true; et=Date.now()+(t*1000); iv=setInterval(tick,200); };
        const stop=()=>{ r=false; clearInterval(iv); };
        const skip=()=>{ const was=r; if(was) stop(); phase(); update(); if(was) start(); };

        e('m1').onclick=()=>(r?stop():start());
        e('colon').onclick=()=>{ e('settings').classList.add('active'); e('overlay').classList.add('active'); };
        e('s2').onclick=skip;
        e('overlay').onclick=()=>{ e('settings').classList.remove('active'); e('overlay').classList.remove('active'); };
        e('lbToggle').onclick=()=>e('lbToggle').classList.toggle('active');
        e('save').onclick=()=>{
            c.work=parseInt(e('workIn').value)||25; c.break=parseInt(e('breakIn').value)||5; c.long=parseInt(e('longIn').value)||15;
            c.lbEnabled=e('lbToggle').classList.contains('active'); localStorage.setItem('pomoConfig',JSON.stringify(c));
            stop(); t=c.work*60; w=true; sl=4; e('overlay').click(); update();
        };
        
        // RESET BEZ POTWIERDZENIA
        e('reset').onclick=()=>{ 
            s={workSecs:0,breakSecs:0}; 
            localStorage.setItem('pomoStats',JSON.stringify(s)); 
            update(); 
            e('overlay').click(); 
        };
        
        window.onresize = fit; update();
    </script>
</body>
</html>
